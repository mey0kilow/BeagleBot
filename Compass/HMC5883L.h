#ifndef HMC5883L_H
#define HMC5883L_H

#include "../I2C/i2c.h"
#include "../GPIO/gpio.h"

#define HMC5883L_ADDR 0x1E

#define HMC5883L_CRA 0x00
#define HMC5883L_CRB 0x01
#define HMC5883L_R_MODE 0x02
#define HMC5883L_DATA_X 0x03
#define HMC5883L_DATA_Y 0x07
#define HMC5883L_DATA_Z 0x05
#define HMC5883L_STATUS 0x09
#define HMC5883L_R_ID_A 0x0A
#define HMC5883L_R_ID_B 0x0B
#define HMC5883L_R_ID_C 0x0C

#define HMC5883L_ID_A 'H'
#define HMC5883L_ID_B '4'
#define HMC5883L_ID_C '3'

#define HMC5883L_CRA_1_SAMPLE 0b00000000
#define HMC5883L_CRA_2_SAMPLE 0b00100000
#define HMC5883L_CRA_4_SAMPLE 0b01000000
#define HMC5883L_CRA_8_SAMPLE 0b01100000

#define HMC5883L_CRA_00_75HZ 0b00000000
#define HMC5883L_CRA_01_50HZ 0b00000100
#define HMC5883L_CRA_03_00HZ 0b00001000
#define HMC5883L_CRA_07_50HZ 0b00001100
#define HMC5883L_CRA_15_00HZ 0b00010000
#define HMC5883L_CRA_30_00HZ 0b00010100
#define HMC5883L_CRA_75_00HZ 0b00011000

#define HMC5883L_CRA_NORMAL_MEASURE 0b00000000
#define HMC5883L_CRA_POSITIVE_MEASURE 0b00000001
#define HMC5883L_CRA_NEGATIVE_MEASURE 0b00000010

#define HMC5883L_CRB_0_88_GAIN 0b00000000
#define HMC5883L_CRB_1_30_GAIN 0b00100000
#define HMC5883L_CRB_1_90_GAIN 0b01000000
#define HMC5883L_CRB_2_50_GAIN 0b01100000
#define HMC5883L_CRB_4_00_GAIN 0b10000000
#define HMC5883L_CRB_4_70_GAIN 0b10100000
#define HMC5883L_CRB_5_60_GAIN 0b11000000
#define HMC5883L_CRB_8_10_GAIN 0b11100000

#define HMC5883L_0_88_GAIN 1370
#define HMC5883L_1_30_GAIN 1090
#define HMC5883L_1_90_GAIN 820
#define HMC5883L_2_50_GAIN 660
#define HMC5883L_4_00_GAIN 440
#define HMC5883L_4_70_GAIN 390
#define HMC5883L_5_60_GAIN 330
#define HMC5883L_8_10_GAIN 230

#define HMC5883L_MODE_HIGH_SPEED_I2C 0b11111100
#define HMC5883L_MODE_CONTINUOUS 0b00000000
#define HMC5883L_MODE_SINGLE 0b00000001
#define HMC5883L_MODE_IDLE 0b00000010

#define HMC5883L_STATUS_LOCK 0b00000010
#define HMC5883L_STATUS_DRDY 0b00000001

#define HMC5883L_DEFAULT_X_MAX 378
#define HMC5883L_DEFAULT_Y_MAX 10
#define HMC5883L_DEFAULT_Z_MAX 124

#define HMC5883L_DEFAULT_X_MIN -207
#define HMC5883L_DEFAULT_Y_MIN -418
#define HMC5883L_DEFAULT_Z_MIN -315

struct axis_t {
	short x, y, z;
};

struct hmc5883l_t;
typedef struct hmc5883l_t * hmc5883l;

hmc5883l hmc5883lCreate(const char *file, int cra, int crb, int mode);
int hmc5883lConfigCRA(hmc5883l mag, int cra);
int hmc5883lConfigCRB(hmc5883l mag, int crb);
int hmc5883lConfigMode(hmc5883l mag, int mode);
int hmc5883lRead(hmc5883l mag, struct axis_t *axis);
int hmc5883lDestroy(hmc5883l mag);

#endif
